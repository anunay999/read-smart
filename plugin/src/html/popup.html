<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="../css/popup.css" />
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="../../assets/icons/icon48.png" alt="read smart">
      <h1>read smart</h1>
    </div>
    
    <button class="settings-button" id="configButton">
      Settings
    </button>
    
    <div class="feature-section">
      <div class="feature-item">
        <div class="feature-info">
          <div class="feature-title">Reader Mode</div>
          <div class="feature-description">Clean, distraction-free reading view</div>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" id="readerModeToggle">
          <span class="slider"></span>
        </label>
      </div>
      
      <div class="feature-item">
        <div class="feature-info">
          <div class="feature-title">Smart Rephrase Mode</div>
          <div class="feature-description">Memory-augmented reading view</div>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" id="rephraseToggle">
          <span class="slider"></span>
        </label>
      </div>
    </div>
    
    <div class="status" id="statusText">
      Normal reading mode
    </div>

    <!-- Progress Indicator -->
    <div id="progressContainer" class="progress-container" style="display:none; margin-top:32px;">
      <div class="progress-track"></div>
      <div id="progressSteps" class="progress-steps"></div>
    </div>

    <div class="action-buttons">
      <button id="memoryButton" class="action-btn primary">
        Add to Memory
      </button>
      <button id="dashboardButton" class="action-btn">
        View Memory
      </button>
    </div>
  </div>
  
  <!-- Configuration Modal -->
  <div id="configModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">API Configuration</h2>
        <button class="close" id="closeModal">&times;</button>
      </div>
      
      <div class="modal-body">
        <div class="api-key-group">
          <label class="api-key-label">Gemini API Key</label>
          <input type="password" id="geminiApiKeyInput" class="api-key-input" placeholder="Enter your Gemini API key">
          <div id="geminiStatus" class="api-status missing">Not configured</div>
        </div>
        
        <div class="api-key-group">
          <label class="api-key-label">Mem0 API Key</label>
          <input type="password" id="mem0ApiKeyInput" class="api-key-input" placeholder="Enter your Mem0 API key">
          <div id="mem0Status" class="api-status missing">Not configured</div>
        </div>

        <!-- BEGIN: Advanced Configuration Collapsible -->
        <details id="advancedSection" class="advanced-section">
          <summary>Advanced Configuration</summary>
          <div class="advanced-body">
            <div class="config-group">
              <label class="config-label">System Prompt</label>
              <textarea id="systemPromptInput" class="config-input textarea" rows="3" placeholder="Enter a custom system prompt"></textarea>
            </div>

            <div class="config-grid">
              <div class="config-group">
                <label class="config-label">Gemini Model</label>
                <select id="geminiModelSelect" class="config-input select">
                  <option value="gemini-2.5-flash">gemini-2.5-flash</option>
                  <option value="gemini-2.5-flash-lite-preview-06-17">gemini-2.5-flash-lite</option>
                  <option value="gemini-2.5-pro">gemini-2.5-pro</option>
                </select>
              </div>

              <div class="config-group">
                <label class="config-label">Relevance Threshold</label>
                <input type="number" id="relevanceThresholdInput" class="config-input" min="0" max="1" step="0.05" placeholder="0.6">
              </div>

              <div class="config-group">
                <label class="config-label">Max Memories</label>
                <input type="number" id="maxMemoriesInput" class="config-input" min="1" max="20" placeholder="6">
              </div>

              <!-- Debug toggle removed as it is not user-facing -->
            </div>
          </div>
        </details>
        <!-- END: Advanced Configuration Collapsible -->
      </div>
      
      <div class="modal-buttons">
        <button id="cancelConfig" class="modal-button cancel">Cancel</button>
        <button id="saveConfig" class="modal-button save">Save Configuration</button>
      </div>
    </div>
  </div>
  
  <script src="../js/popup.js"></script>
</body>
</html>
